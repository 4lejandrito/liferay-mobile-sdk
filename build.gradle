subprojects {
	repositories {
		mavenLocal()
		mavenCentral()
	}

	task release << { task ->
		println "-----------------------"
	}

	release.dependsOn {
		project.tasks.withType(Jar)
		project.tasks.withType(Zip)
	}
}

configure(subprojects.findAll { it.name != 'ios' }) {
	apply plugin: 'java'
	apply plugin: 'eclipse'
	apply plugin: 'maven'

	repositories {
		maven {
			url 'https://repository.liferay.com/nexus/content/groups/liferay-ce'
		}
	}

	configurations {
		formatter
	}

	dependencies {
		formatter group: 'com.liferay.portal', name: 'portal-impl', version: '6.2.0-ga1'
		formatter group: 'com.liferay.portal', name: 'portal-service', version: '6.2.0-ga1'
		formatter group: 'com.liferay.portal', name: 'util-java', version: '6.2.0-ga1'
		formatter group: 'dom4j', name: 'dom4j', version: '1.6.1'
		formatter group: 'org.apache.ant', name: 'ant', version: '1.8.2'
	}

	install {
		repositories.mavenInstaller {
			pom.groupId = 'com.liferay.mobile'
		}
	}

	task format(type: JavaExec) {
		main = 'com.liferay.portal.tools.sourceformatter.SourceFormatter'
		classpath = configurations.formatter
		workingDir = 'src/main/java'
	}
}

configure(subprojects.findAll { it.name != 'builder' }) {
	defaultTasks 'buildService'

	configurations {
		builder
	}

	dependencies {
		builder project(':builder')
	}

	def builderMainClass = 'com.liferay.mobile.sdk.SDKBuilder'
	def builderClasspath = configurations.builder
	def platform = project.name

	task buildSyncWebService(type: JavaExec) {
		main = builderMainClass
		classpath = builderClasspath

		args = [
			"platform=$platform",
			"url=$url",
			"context=sync-web",
			"filter=$filter",
			"packageName=$packageName",
			"destination=$destination"
		]
	}

	task buildService(type: JavaExec, dependsOn: buildSyncWebService) {
		main = builderMainClass
		classpath = builderClasspath

		args = [
			"platform=$platform",
			"url=$url",
			"context=$context",
			"filter=$filter",
			"packageName=$packageName",
			"destination=$destination"
		]
	}
}

task wrapper(type: Wrapper) {
	gradleVersion = '1.11'
}
